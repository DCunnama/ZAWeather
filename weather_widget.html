<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZuluAlpha Weather Widget</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 10px; }
  .weather-widget { max-width: 320px; border: 1px solid #ccc; padding: 10px; }
  .weather-widget h2 { font-size: 1.2em; margin: 0 0 10px; }
  .weather-widget .value { font-weight: bold; }
  iframe { width: 100%; border: none; height: 360px; }
</style>
</head>
<body>
<div class="weather-widget">
  <h2>Current Weather</h2>
  <div>Temperature: <span id="temperature" class="value"></span> Â°C</div>
  <div>Wind: <span id="wind" class="value"></span> km/h</div>
  <div>Humidity: <span id="humidity" class="value"></span>%</div>
  <div>Cloud Cover: <span id="cloud" class="value"></span>%</div>
  <div>Sunrise: <span id="sunrise" class="value"></span></div>
  <div>Sunset: <span id="sunset" class="value"></span></div>
  <div>Moonrise: <span id="moonrise" class="value"></span></div>
  <div>Moonset: <span id="moonset" class="value"></span></div>
  <div>Moon Phase: <span id="moonphase" class="value"></span></div>
  <div>Moon Illumination: <span id="moonillum" class="value"></span>%</div>
</div>

<h2>Radar (Southern Africa)</h2>
<iframe
  src="https://embed.windy.com/embed2.html?lat=-32.3587&lon=20.6203&zoom=4&level=surface&overlay=radar&product=radar&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&detailLat=-32.3587&detailLon=20.6203&metricWind=default&metricTemp=default&radarRange=-1"
  allowfullscreen="allowfullscreen">
</iframe>

<script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
<script>
const lat = -32.35871980906897;
const lon = 20.62026635302537;

function fetchWeather() {
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relative_humidity_2m,cloudcover&timezone=auto`;
  fetch(url)
    .then(resp => resp.json())
    .then(data => {
      const current = data.current_weather;
      document.getElementById('temperature').textContent = current.temperature;
      document.getElementById('wind').textContent = current.windspeed;

      const idx = data.hourly.time.indexOf(current.time);
      if (idx >= 0) {
        document.getElementById('humidity').textContent = data.hourly.relative_humidity_2m[idx];
        document.getElementById('cloud').textContent = data.hourly.cloudcover[idx];
      }

      const now = new Date(current.time);
      const sunTimes = SunCalc.getTimes(now, lat, lon);
      const moonTimes = SunCalc.getMoonTimes(now, lat, lon);
      const moonIllum = SunCalc.getMoonIllumination(now);
      
      function fmt(t) {
        return t ? t.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : 'N/A';
      }

      document.getElementById('sunrise').textContent = fmt(sunTimes.sunrise);
      document.getElementById('sunset').textContent = fmt(sunTimes.sunset);
      document.getElementById('moonrise').textContent = fmt(moonTimes.rise);
      document.getElementById('moonset').textContent = fmt(moonTimes.set);
      document.getElementById('moonphase').textContent = moonPhaseName(moonIllum.phase);
      document.getElementById('moonillum').textContent = Math.round(moonIllum.fraction * 100);
    })
    .catch(err => console.error('Weather fetch error:', err));
}

function moonPhaseName(phase) {
  const p = phase * 8;
  const phases = ['New Moon', 'Waxing Crescent', 'First Quarter', 'Waxing Gibbous', 'Full Moon', 'Waning Gibbous', 'Last Quarter', 'Waning Crescent'];
  return phases[Math.round(p) % 8];
}

fetchWeather();
</script>
</body>
</html>
